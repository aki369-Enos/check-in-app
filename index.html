<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點名系統 - 最終完工版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .card-active { background: #dcfce7; border-color: #22c55e; color: #15803d; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-6">
    <div class="max-w-md mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800">點名系統</h1>
            <p class="text-slate-500 text-sm mt-2">即時同步雲端試算表</p>
        </header>

        <div id="loading" class="text-center py-20 glass rounded-3xl shadow-lg">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
            <p class="text-slate-600 font-medium">資料傳輸中...</p>
        </div>

        <div id="list" class="grid grid-cols-1 gap-3 hidden">
            </div>
    </div>

    <script>
// 請確保這裡的網址跟妳剛剛貼給我的是「同一個」！
const API_URL = 'https://script.google.com/macros/s/AKfycbyBncPUbKeny0vZLeL0e391pvNAcbs_RQD1fDF-DhV9RqT6WOg4itsD51Va-pbG87XJ/exec';

        // 1. 抓取資料 (JSONP)
        function init() {
            const script = document.createElement('script');
            script.src = `${API_URL}?callback=render&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        // 2. 顯示名單
        window.render = function(data) {
            const listDiv = document.getElementById('list');
            const loadingDiv = document.getElementById('loading');
            
            listDiv.innerHTML = data.employeeList.map(emp => `
                <div class="flex items-center justify-between p-5 bg-white rounded-2xl border-2 border-transparent shadow-sm transition-all ${emp.isChecked ? 'card-active' : ''}">
                    <span class="text-lg font-bold">${emp.name}</span>
                    <input type="checkbox" class="w-7 h-7 accent-green-600" 
                           ${emp.isChecked ? 'checked' : ''} 
                           onchange="sync('${emp.name}', this.checked, this)">
                </div>
            `).join('');
            
            loadingDiv.classList.add('hidden');
            listDiv.classList.remove('hidden');
        };

        // 3. 同步回傳
        function sync(name, isChecked, el) {
            // 視覺即時反饋
            const card = el.parentElement;
            if (isChecked) card.classList.add('card-active');
            else card.classList.remove('card-active');

            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ name, isChecked })
            });
        }

        window.onload = init;
    </script>
</body>
</html>
