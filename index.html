<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點名系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f8fafc; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .card-active { 
            background: linear-gradient(135deg, #dcfce7 0%, #ffffff 100%); 
            border: 2px solid #22c55e !important; 
            box-shadow: 0 10px 15px -3px rgba(34, 197, 94, 0.2);
        }
    </style>
</head>
<body class="min-h-screen pb-12">
    <div class="max-w-5xl mx-auto px-4 pt-8 text-center">
        <h1 class="text-3xl font-bold text-slate-800 mb-8">點名系統</h1>
        
        <div id="loading-view" class="flex flex-col items-center justify-center py-20">
            <div class="w-12 h-12 border-4 border-slate-200 border-t-blue-500 rounded-full animate-spin mb-4"></div>
            <p class="text-slate-400">正在連接雲端...</p>
        </div>

        <div id="main-content" class="hidden grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
            </div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwTtT_QfAZLEdvvpJG7MhAB3d9o1kNAijYKVDqtt0FE4nCTY3iWVd2HlU5EN7JK5ghc/exec';

        async function init() {
            try {
                const res = await fetch(`${API_URL}?t=${Date.now()}`);
                const data = await res.json();
                
                document.getElementById('loading-view').classList.add('hidden');
                document.getElementById('main-content').classList.remove('hidden');
                
                const grid = document.getElementById('main-content');
                grid.innerHTML = data.employeeList.map(emp => `
                    <div class="p-4 rounded-2xl border border-slate-200 bg-white shadow-sm flex items-center justify-between ${emp.isChecked ? 'card-active' : ''}">
                        <span class="font-medium text-slate-700">${emp.name}</span>
                        <input type="checkbox" class="w-5 h-5 accent-green-600" ${emp.isChecked ? 'checked' : ''} 
                               onchange="toggle('${emp.name}', this.checked)">
                    </div>
                `).join('');
            } catch (err) {
                alert("連線失敗，請檢查 GAS 部署是否正確！");
            }
        }

        async function toggle(name, isChecked) {
            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ name, isChecked })
            });
            // 點擊後稍微變色提示，不需要等待伺服器
            init(); 
        }

        window.onload = init;
    </script>
</body>
</html>
