<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>點名系統-最終修復版</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen p-6">
    <div class="max-w-md mx-auto bg-white rounded-3xl shadow-xl p-6">
        <h1 class="text-2xl font-bold text-center text-slate-800 mb-6">點名系統</h1>
        <div id="loading" class="text-center py-10">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p id="msg" class="text-slate-500">正在強制連接雲端...</p>
        </div>
        <div id="list" class="space-y-3 hidden"></div>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwTtT_QfAZLEdvvpJG7MhAB3d9o1kNAijYKVDqtt0FE4nCTY3iWVd2HlU5EN7JK5ghc/exec';

        // 使用 JSONP 方式，繞過瀏覽器的 Failed to fetch 限制
        function loadData() {
            const script = document.createElement('script');
            script.src = `${API_URL}?callback=renderUI&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        window.renderUI = function(data) {
            const listDiv = document.getElementById('list');
            const loadingDiv = document.getElementById('loading');
            
            if (!data.employeeList) {
                document.getElementById('msg').innerText = "抓到資料了，但名單是空的！";
                return;
            }

            listDiv.innerHTML = data.employeeList.map(emp => `
                <div class="flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100">
                    <span class="font-medium text-slate-700">${emp.name}</span>
                    <input type="checkbox" class="w-6 h-6 rounded accent-green-600" 
                           ${emp.isChecked ? 'checked' : ''} 
                           onchange="updateStatus('${emp.name}', this.checked)">
                </div>
            `).join('');
            
            loadingDiv.classList.add('hidden');
            listDiv.classList.remove('hidden');
        };

        function updateStatus(name, isChecked) {
            // POST 更新通常不需要 JSONP，維持 no-cors 即可
            fetch(API_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ name, isChecked })
            });
        }

        window.onload = loadData;
    </script>
</body>
</html>
